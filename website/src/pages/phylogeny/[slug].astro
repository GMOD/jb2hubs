---
import Layout from '../../layouts/Layout.astro'
import Container2 from '../../components/Container2.astro'
import ClientOnlyPhylogeneticTree from '../../components/ClientOnlyPhylogeneticTree.tsx'

export async function getStaticPaths() {
  const modules = import.meta.glob('../../../processedHubJson/*.json')
  const paths = await Promise.all(
    Object.entries(modules).map(async ([filepath, resolver]) => {
      const { default: data } = await resolver()
      const slug = filepath.split('/').pop().replace('.json', '')
      return slug !== 'all'
        ? {
            params: { slug },
            props: { rows: data },
          }
        : undefined
    }),
  )
  return paths.filter(f => !!f)
}

const { slug } = Astro.params
const { rows } = Astro.props

const title = slug.charAt(0).toUpperCase() + slug.slice(1)
---

<Layout title={`GenArk phylogeny - ${title}`}>
  <Container2>
    <h1>GenArk phylogeny - {title}</h1>
    <div style="margin-bottom: 16px;">
      <a href={`/hubs/${slug}`} style="color: #2563eb; text-decoration: underline;">
        View data table for {title}
      </a>
    </div>
    <ClientOnlyPhylogeneticTree category={slug} speciesData={rows} autoShow={true} client:load />
  </Container2>
</Layout>
